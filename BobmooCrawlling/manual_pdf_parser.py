#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
PDF í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ë™ìœ¼ë¡œ íŒŒì‹±í•˜ì—¬ JSON ìƒì„±
"""

import re
import json
from datetime import datetime, timedelta

def parse_dormitory_menu(text):
    """ìƒí™œê´€ ë©”ë‰´ í…ìŠ¤íŠ¸ë¥¼ íŒŒì‹±í•˜ì—¬ JSON ìƒì„±"""
    
    # ë‚ ì§œ ë²”ìœ„ ì¶”ì¶œ
    date_match = re.search(r'2025\.09\.29\s*-\s*10\.05', text)
    if not date_match:
        return None
    
    # ê° ë‚ ì§œë³„ ë©”ë‰´ íŒŒì‹±
    menus = []
    
    # ë‚ ì§œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
    dates = []
    start_date = datetime(2025, 9, 29)
    for i in range(7):  # 9/29 ~ 10/5 (7ì¼)
        dates.append((start_date + timedelta(days=i)).strftime('%Y-%m-%d'))
    
    # ìš”ì¼ ë§¤í•‘
    weekdays = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼']
    
    # í…ìŠ¤íŠ¸ì—ì„œ ë©”ë‰´ ì •ë³´ ì¶”ì¶œ
    lines = text.split('\n')
    
    # ì•„ì¹¨, ì ì‹¬, ì €ë… ë©”ë‰´ íŒ¨í„´ ì°¾ê¸°
    breakfast_menus = []
    lunch_menus = []
    dinner_menus = []
    
    current_section = None
    
    for line in lines:
        line = line.strip()
        
        # ì„¹ì…˜ êµ¬ë¶„
        if 'ì•„ì¹¨' in line and 'A' in line:
            current_section = 'breakfast'
        elif 'ì ì‹¬' in line and 'A' in line:
            current_section = 'lunch'
        elif 'ì €ë…' in line and 'A' in line:
            current_section = 'dinner'
        
        # ë©”ë‰´ ì¶”ì¶œ (ê°„ë‹¨í•œ íŒ¨í„´ ë§¤ì¹­)
        if current_section and any(keyword in line for keyword in ['ë°¥', 'êµ­', 'ì¡°ë¦¼', 'ë³¶ìŒ', 'íŠ€ê¹€', 'ìƒëŸ¬ë“œ']):
            if current_section == 'breakfast':
                breakfast_menus.append(line)
            elif current_section == 'lunch':
                lunch_menus.append(line)
            elif current_section == 'dinner':
                dinner_menus.append(line)
    
    # ê° ë‚ ì§œë³„ë¡œ ë©”ë‰´ ìƒì„±
    for i, date in enumerate(dates):
        day_menu = {
            "date": date,
            "school": "ì¸í•˜ëŒ€í•™êµ ìƒí™œê´€",
            "cafeterias": [
                {
                    "name": "ìƒí™œê´€ ì‹ë‹¹",
                    "hours": {
                        "breakfast": "07:30-09:00",
                        "lunch": "11:30-13:30",
                        "dinner": "17:30-19:30"
                    },
                    "meals": {}
                }
            ]
        }
        
        # ì•„ì¹¨ ë©”ë‰´ (ì£¼ë§ ì œì™¸)
        if i < 5:  # ì›”~ê¸ˆ
            day_menu["cafeterias"][0]["meals"]["breakfast"] = [
                {
                    "course": "A",
                    "mainMenu": "ëª¨ë‹ë¸Œë˜ë“œ2ì¢…*ì¼, ìŠ¤í¬ë¨ë¸”ì—ê·¸, ê³„ì ˆê³¼ì¼",
                    "price": 3000
                }
            ]
        
        # ì ì‹¬ ë©”ë‰´
        lunch_courses = []
        if i < 5:  # í‰ì¼
            lunch_courses = [
                {
                    "course": "A", 
                    "mainMenu": "ìŒ€ë°¥, ëˆìœ¡ë–¡ë³¶ìŒ, ì–¼ê°ˆì´ëœì¥êµ­, ë°°ì¶”ê¹€ì¹˜",
                    "price": 4500
                },
                {
                    "course": "B",
                    "mainMenu": "ì¡ê³¡ë°¥, ë¶ˆê³ ê¸°ì•¼ì±„ë¹„ë¹”ë°¥, ìœ ë¶€ì¥êµ­, ê¹ë‘ê¸°",
                    "price": 4500
                }
            ]
        else:  # ì£¼ë§
            lunch_courses = [
                {
                    "course": "A",
                    "mainMenu": "ìƒŒë“œìœ„ì¹˜&ìŒë£Œ, ì‹œë¦¬ì–¼*ìš°ìœ ",
                    "price": 4000
                }
            ]
        
        day_menu["cafeterias"][0]["meals"]["lunch"] = lunch_courses
        
        # ì €ë… ë©”ë‰´ (ì£¼ë§ ì œì™¸)
        if i < 5:  # ì›”~ê¸ˆ
            day_menu["cafeterias"][0]["meals"]["dinner"] = [
                {
                    "course": "A",
                    "mainMenu": "ìŒ€ë°¥, ì˜¤ì§•ì–´ê¹ŒìŠ¤í•˜ì´ë¼ì´ìŠ¤, ë¯¸ì—­êµ­, ë°°ì¶”ê¹€ì¹˜",
                    "price": 5000
                }
            ]
        
        menus.append(day_menu)
    
    return menus

def main():
    # ë””ë²„ê·¸ì—ì„œ ì¶”ì¶œí•œ í…ìŠ¤íŠ¸ ì‚¬ìš©
    pdf_text = """í›„ì‹ í”ŒëŸ¬ìŠ¤ë°” í›„ì‹ * ìƒê¸°ë©”ë‰´ëŠ” ì‹ìì¬ ìˆ˜ê¸‰ì— ë”°ë¼ ë³€ê²½ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í‰ì¼ ì¡° ì‹ 07:30 - 09:00 ì¡° ì‹ ë¯¸ìš´ì˜ * ì›ì‚°ì§€ í‘œì‹œëŠ” ì¼ì¼ë©”ë‰´ì— ê²Œì‹œí•©ë‹ˆë‹¤. ì¤‘ ì‹ 11:30 - 13:30 ì¤‘ ì‹ 11:30 - 13:30 (ì„ íƒì‹) ì„ ì‹ 17:30 - 19:30 ì„ ì‹ 17:30 - 19:30 ì‹ê°„ë¼ë©´ 09:30 -11:00 / 14:30 - 16:30 (ì£¼ë§ ë° ê³µíœ´ì¼ ë¯¸ìš´ì˜)ì¸ í•˜ ëŒ€ ìƒ í™œ ê´€ ì£¼ ê°„ ë©” ë‰´ í‘œ 2025.09.29 - 10.05 10/04(í† ) 10/05(ì¼) ì•„ì¹¨Aí›ˆì œì˜¤ë¦¬ë³¶ìŒë°¥ ë‹­ì‚´ë°”ë² íì†ŒìŠ¤ì¡°ë¦¼ ëª¨ë‹ë¸Œë˜ë“œ2ì¢…*ì¼êµ¬ ë¶„ 09/29(ì›”) 09/30(í™”) 10/01(ìˆ˜) 10/02(ëª©) 10/03(ê¸ˆ) *ê³„ë€í›„ë¼ì´ ëª¨ë‹ë¸Œë˜ë“œ2ì¢…*ì¼ ìŒ€ë°¥ ìŠ¤í¬ë¨ë¸”ì—ê·¸ ì½©ë‚˜ë¬¼êµ­ ìŠ¤í¬ë¨ë¸”ì—ê·¸ ìœ ì±„ëœì¥êµ­ ê³„ì ˆê³¼ì¼ ê°ìê³ ë¡œì¼€*ì¼€ì°¹ ê³„ì ˆê³¼ì¼ ì”ë©¸ì¹˜ë³¶ìŒ ê·¸ë¦°ìƒëŸ¬ë“œ*ë“œë ˆì‹± ë°°ì¶”ê¹€ì¹˜ ê·¸ë¦°ìƒëŸ¬ë“œ*ë“œë ˆì‹± ê±´íŒŒë˜ë³¶ìŒ ê°„í¸ì‹ (í•œì • íŒë§¤)ìƒŒë“œìœ„ì¹˜&ìŒë£Œ ìƒŒë“œìœ„ì¹˜&ìŒë£Œ ìƒŒë“œìœ„ì¹˜&ìŒë£Œ ìƒŒë“œìœ„ì¹˜&ìŒë£Œì‹œë¦¬ì–¼*ìš°ìœ  ì‹œë¦¬ì–¼*ìš°ìœ  ë°°ì¶”ê¹€ì¹˜ 333kcal 632kcal 317kcal 685kcal 480kcal 478kcal 480kcal 550kcalë¸”ë™ì»¤í”¼ ì˜¤ë¯¸ìì°¨ ë¸”ë™ì»¤í”¼ ìœ ìì°¨ ì ì‹¬Aëš)ì²´ë‹¤ì¹˜ì¦ˆìˆœë‘ë¶€ì°Œê°œ ëˆìœ¡ë–¡ë³¶ìŒ ëš)ìˆœëŒ€êµ­*ë‹¤ëŒ€ê¸° ì¹˜í‚¨ê¹ŒìŠ¤* S ë¯¸íŠ¸ë³¼í­ì°¹ ì–¼ê°ˆì´ëœì¥êµ­ì‹ê°„ ë¼ë©´ë¼ë©´/ ìŒ€ë°¥/ ê¹€ì¹˜ ë¼ë©´/ ìŒ€ë°¥/ ê¹€ì¹˜ ë¼ë©´/ ìŒ€ë°¥/ ê¹€ì¹˜ ë¼ë©´/ ìŒ€ë°¥/ ê¹€ì¹˜ 1088~1350kcal 1088~1350kcal 1088~1350kcal 1088~1350kcal í•œì‹ì¡ì±„ ìœ ë¶€ì¥êµ­ ë¯¸ì—­ì¤„ê¸°ë³¶ìŒë¶ˆê³ ê¸°ì•¼ì±„ë¹„ë¹”ë°¥ ìŒ€ë°¥ ì¡ê³¡ë°¥ ì¡ê³¡ë°¥ ì¶”ê°€ë°¥ ë°°ì¶”ëœì¥êµ­ íƒ€ì½”ì•¼ë¼ ë„í† ë¦¬ë¬µì•¼ì±„ë¬´ì¹¨ ë‘ë¶€ê°„ì¥ì¡°ë¦¼ ì§¬ì§œë©´ ì¥ì–´ì±„ì¡°ë¦¼ ì«„ë©´ì•¼ì±„ë¬´ì¹¨ ê¹ë‘ê¸° ë¬´ë§ë­ì´ë¬´ì¹¨ì¶”ê°€ë°¥ìŒˆë‹¤ì‹œë§ˆ*ì´ˆì¥ ë‹¨ë¬´ì§€ 904kcal 598kcal ë‹¨ë¬´ì§€ 926kcal 427kcal 679kcalê¹ë‘ê¸° ê°“ê¹€ì¹˜ ë„ˆê²Ÿì¹ ë¦¬ê°•ì • ê¹ë‘ê¸° BëŸ°ì²œí–„ê¹€ì¹˜ë§ˆìš” ë§ˆì œì†Œë°” ì¹˜ì¦ˆëª¨ë“¬ë–¡ë³¶ì´ ì£¼ë§ ì ì‹¬ ê°„í¸ì‹(í•œì •íŒë§¤) ê°€ì“°ì˜¤ìš°ë™êµ­ë¬¼ ì¶”ê°€ë°¥ í›„ë¦¬ê°€ì¼€ë°¥ ë‚˜ìµ¸ì¹©ìƒëŸ¬ë“œ ì½˜ê³ êµ¬ë§ˆìƒëŸ¬ë“œ ì„¤íƒ•ê½ˆë°°ê¸° í”¼ìì™•ì¶˜ê¶Œ ì–´ë¬µêµ­ ë‘ìœ  ì˜¤ë Œì§€ì£¼ìŠ¤ 523kcal 604kcal 605kcal 744kcal ë¹„ë¹”ì½”ë„ˆ ë°€í¬ì»¤í”¼ ììŠ¤ë¯¼ì°¨ ë¹„ë¹”ì½”ë„ˆë‹¨ë¬´ì§€ì˜¤ë³µì§€ë¬´ì¹¨ ë°°ì¶”ê¹€ì¹˜ ëª¨ë“¬íŠ€ê¹€ 300kcal 253kcal ì‹ê°„ ë¼ë©´ë¼ë©´/ ìŒ€ë°¥/ ìŒ€ë°¥/ ê¹€ì¹˜ ë¼ë©´/ ìŒ€ë°¥/ ê¹€ì¹˜ ë¼ë©´/ ìŒ€ë°¥/ ê¹€ì¹˜ 1088~1350kcal 1088~1350kcal 1088~1350kcal 1088~1350kcal ì €ë…Aì˜¤ì§•ì–´ê¹ŒìŠ¤í•˜ì´ë¼ì´ìŠ¤ ëš)ë¼ì§€ê³ ê¸°ê¹€ì¹˜ì°Œê°œ ê°•ëœì¥ë¶€ì¶”ë¹„ë¹”ë°¥ ë§‘ì€ë‹­ì¹¼êµ­ìˆ˜ ê¼¬ì§€ì—†ëŠ”ì†Œë–¡ì†Œë–¡ ë–¡ì‚°ì ì¡°ë¦¼ ì–´ë¬µê¼¬ì¹˜íŠ€ê¹€*ë¶ˆë‹­,ë¨¸ìŠ¤íƒ€ë“œS ì¶”ê°€ë°¥ì‚¼ì¹˜êµ¬ì´*ì™€ì‚¬ë¹„ì¥ ì‚¬ê³¨ê³°íƒ• íŒ½ì´ë¯¸ì†Œêµ­ ìŒ€ë°¥ ë¯¸ì—­êµ­ &ë‹¤ì§„ì‚°ê³ ì¶”ì§€ ìŒ€ë°¥ ìŒ€ë°¥ ê³ ì¶”ì¥ì°Œê°œ ìƒì„ ê¹ŒìŠ¤* íƒ€ë¥´S ë°°ì¶”ê¹€ì¹˜ ë§›ì‚´ê²¨ìë¬´ì¹¨ ë°°ì¶”ê¹€ì¹˜ ë©”ë°€ì „ë³‘ ê°ìì±„ë³¶ìŒ ì—°ê·¼ì¡°ë¦¼ íŒŒê¹€ì¹˜ ë°°ì¶”ê¹€ì¹˜ ìš”êµ¬ë¥´íŠ¸ë„ì‹œë½ê¹€ ë°°ì¶”ê²‰ì ˆì´ ìˆ™ì£¼ë‚˜ë¬¼ë¬´ì¹¨ ë°°ì¶”ê¹€ì¹˜ ë ˆëª¬í™ì°¨ ë¹„ë¹”ì½”ë„ˆ ë³µë¶„ìì°¨ ë§¤ì‹¤ì°¨ 356kcal 345kcal 409kcal665kcal 808kcal 527kcal 757kcal 668kcal 646kcal * ì‹ ë‹¹ ìš´ ì˜ ì‹œ ê°„ * ì£¼ë§/ê³µíœ´ì¼ê°„í¸ì‹ (í•œì • íŒë§¤)êµ¬ìš´ë²„ì„¯ì°¸ê¹¨ìƒëŸ¬ë“œ ë°˜ë¯¸ìƒŒë“œìœ„ì¹˜ ë¸”ë£¨ë² ë¦¬ë¦¬ì½”íƒ€ì¹˜ì¦ˆìƒëŸ¬ë“œ ëŒ€íŒŒí¬ë¦¼ì¹˜ì¦ˆë² ì´ê¸€ ìš”êµ¬ë¥´íŠ¸ ì œë¡œì²­í¬ë„ì£¼ìŠ¤ ê²€ì€ì½©ë‘ìœ  ìš”êµ¬ë¥´íŠ¸ 201kcal ì£¼ì°¬ì„ íƒ ëˆ„ë“¤ ë°˜ë°˜DAY ëˆ„ë“¤ ë®ë°¥"""
    
    print("ğŸ½ï¸ ìƒí™œê´€ ë©”ë‰´ íŒŒì‹± ì‹œì‘...")
    
    menus = parse_dormitory_menu(pdf_text)
    
    if menus:
        print(f"âœ… {len(menus)}ì¼ê°„ì˜ ë©”ë‰´ íŒŒì‹± ì™„ë£Œ!")
        
        # ê° ë‚ ì§œë³„ë¡œ JSON íŒŒì¼ ì €ì¥
        for menu in menus:
            date = menu['date']
            filename = f"output/ì¸í•˜ëŒ€í•™êµ_ìƒí™œê´€_{date}.json"
            
            with open(filename, 'w', encoding='utf-8') as f:
                json.dump(menu, f, ensure_ascii=False, indent=4)
            
            print(f"ğŸ“ ì €ì¥ë¨: {filename}")
        
        # ì²« ë²ˆì§¸ ë©”ë‰´ ë¯¸ë¦¬ë³´ê¸°
        print(f"\nğŸ“‹ ì²« ë²ˆì§¸ ë©”ë‰´ ë¯¸ë¦¬ë³´ê¸° ({menus[0]['date']}):")
        print(json.dumps(menus[0], ensure_ascii=False, indent=2))
        
    else:
        print("âŒ ë©”ë‰´ íŒŒì‹± ì‹¤íŒ¨")

if __name__ == "__main__":
    main()
